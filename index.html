<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz App</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <h1>Quiz App</h1>
    <button id="start-button">Start Quiz</button>
    <div id="quiz-container" style="display:none;">
      <h2 id="question"></h2>
      <div id="options"></div>
    </div>
    <div id="result-container" style="display:none;">
      <h2>Your Score: <span id="score"></span></h2>
    </div>
  </div>
  <script src="script.js"></script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="input.css">
  </head>
  <body>
    <div id="auth-container" class="flex justify-center items-center h-screen">
      <div class="w-[20rem] bg-white p-6 rounded-md shadow-md">
        <form id="auth-form">
          <label class="block mt-4 text-sm font-medium text-gray-700">
            <span class="font-bold">Name</span>
            <input
              type="text"
              id="name"
              class="block w-full mt-1 border border-gray-300 rounded-md shadow-sm"
            />
          </label>
          <label class="block mt-4 text-sm font-medium text-gray-700">
            <span class="font-bold">Email</span>
            <input
              type="email"
              id="email"
              class="block w-full mt-1 border border-gray-300 rounded-md shadow-sm"
            />
          </label>
          <label class="block mt-4 text-sm font-medium text-gray-700">
            <span class="font-bold">Password</span>
            <input
              type="password"
              id="password"
              class="block w-full mt-1 border border-gray-300 rounded-md shadow-sm"
            />
          </label>
          <button
            type="button"
            id="register-btn"
            class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-md"
          >
            Register
          </button>
          <button
            type="button"
            id="login-btn"
            class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-md"
          >
            Login
          </button>
        </form>
        <h2
          class="message font-bold text-red-500 text-2xl text-center mt-5"
        ></h2>
      </div>
    </div>

    <div id="header" class="hidden flex">
      <div id="head">
        <h1>Quiz</h1>
      </div>
      <div id="userDetails">
        <h1>Name:</h1>
        <h2>Email:</h2>
      </div>
      <button
        id="logout-btn"
        class="hidden mt-4 bg-blue-600 text-white px-4 py-2 rounded-md"
      >
        Logout
      </button>
    </div>
    <div
      id="quiz-container"
      class="hidden flex justify-center items-center h-screen"
    >
      <div class="w-[40rem] bg-white p-6 rounded-md shadow-md">
        <form id="quiz-form">
          <label
            for="level"
            class="block mt-4 text-sm font-medium text-gray-700"
          >
            <span class="font-bold">Select level</span>
            <select
              id="level"
              class="block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
            >
              <option disabled selected>Select level</option>
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>
          </label>
          <label
            for="category"
            class="block mt-4 text-sm font-medium text-gray-700"
          >
            <span class="font-bold">Select category</span>
            <select
              id="category"
              class="block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
            >
              <option disabled selected>Select category</option>
              <option value="Sports">Sports</option>
              <option value="Movies">Movies</option>
              <option value="General">General</option>
            </select>
          </label>
          <div id="questions-container">
            <div class="questions">
              <label class="block mt-4 text-sm font-medium text-gray-700">
                <span class="font-bold">Write Question</span>
                <textarea
                  class="question block w-full mt-1 border border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  rows="4"
                  placeholder="Write Question..."
                ></textarea>
              </label>
              <label class="block mt-4 text-sm font-medium text-gray-700">
                Option-1
                <input
                  type="text"
                  class="option1 block w-full h-10 mt-1 border border-gray-300 rounded-md shadow-sm"
                />
              </label>
              <label class="block mt-4 text-sm font-medium text-gray-700">
                Option-2
                <input
                  type="text"
                  class="option2 block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm"
                />
              </label>
              <label class="block mt-4 text-sm font-medium text-gray-700">
                Option-3
                <input
                  type="text"
                  class="option3 block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm"
                />
              </label>
              <label class="block mt-4 text-sm font-medium text-gray-700">
                Option-4
                <input
                  type="text"
                  class="option4 block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm"
                />
              </label>
              <label class="block mt-4 text-sm font-medium text-gray-700">
                Answer
                <input
                  type="text"
                  class="answer block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm"
                />
              </label>
            </div>
          </div>
          <button
            type="button"
            id="add-question-btn"
            class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-md"
          >
            Add Question
          </button>
          <button
            type="button"
            id="save-btn"
            class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-md"
          >
            Save Questions
          </button>
        </form>
        <h2
          class="message font-bold text-green-500 text-2xl text-center mt-5"
        ></h2>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      const firebaseConfig = {
        apiKey: "AIzaSyAbhyn7IYXBRaeFiIqVhHaDekjKont0KiU",
        authDomain: "quiz-9bae3.firebaseapp.com",
        projectId: "quiz-9bae3",
        storageBucket: "quiz-9bae3.appspot.com",
        messagingSenderId: "1068775644405",
        appId: "1:1068775644405:web:3333a3ae843dd6b2e039bc",
        measurementId: "G-NHZJ3R09VW",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const authContainer = document.getElementById("auth-container");
      const quizContainer = document.getElementById("quiz-container");
      const logoutBtn = document.getElementById("logout-btn");
      const header = document.getElementById("header");

      const showMessage = (message, className) => {
        const messageElement = document.querySelector(`.${className}`);
        messageElement.textContent = message;
      };

      const register = document.getElementById("register-btn");
      register.addEventListener("click", async (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        // const message = document.querySelector(".message");

        // const auth = getAuth();
        // const db = getFirestore();

        //   createUserWithEmailAndPassword(auth, email, password)
        //   .then((userCredential) => {
        //     const user = userCredential.user;
        //     const userData = {
        //         email : email
        //     }
        //   })
        //   .catch((error)=>{
        //     const errorCode=error.code;
        //     if(errorCode=='auth/email-already-in-use'){
        //         showMessage('Email Already Exists', 'signUpMessage');
        //     }
        //     else{
        //         showMessage('unable to create User', 'signUpMessage');
        //     }
        // })

        try {
          const userCredential = await createUserWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;
          await addDoc(collection(db, "users"), {
            uid: user.uid,
            name: user.name,
            email: user.email,
          });
          showMessage("Registration successfully", "message");
        } catch (error) {
          const errorCode = error.code;
          if (errorCode === "auth/email-already-in-use") {
            showMessage("Email Already Exists", "message");
          } else {
            showMessage("Unable to create user", "message");
          }
        }
      });

      const login = document.getElementById("login-btn");
      login.addEventListener("click", async (e) => {
        e.preventDefault();
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        // const auth = getAuth();

        // loginWithEmailAndPassword(auth,email,password)
        // .then((userCredential) => {
        //     showMessage("login is successfully", "loginMessage")
        //     const user = userCredential.user;
        //     localStorage.setItem("loggedInUserId", user.uid);
        //     window.location.href = "newIndex.html";
        // })
        // .catch((error) => {
        //     const errorCode = error.code;
        //     if(errorCode === "auth/invalid-credential"){
        //         showMessage("Incorrect Email or Password", "loginMessage");
        //     }
        //     else{
        //         showMessage("Account doesn't Exist", "loginMessage")
        //     }
        // })

        try {
          const userCredential = await signInWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;
          localStorage.setItem("loggedInUserId", user.uid);
          showMessage("Login successful!", "message");
        } catch (error) {
          const errorCode = error.code;
          if (
            errorCode === "auth/user-not-found" ||
            errorCode === "auth/wrong-password"
          ) {
            showMessage("Invalid Email or Password", "message");
          } else {
            showMessage("Unable to login", "message");
          }
        }
      });

      //   const authContainer = document.getElementById("auth-container");
      //   const quizContainer = document.getElementById("quiz-container");
      //   const authForm = document.getElementById("auth-form");
      //   const registerBtn = document.getElementById("register-btn");
      //   const loginBtn = document.getElementById("login-btn");
      //   const logoutBtn = document.getElementById("logout-btn");

      const addQuestionBtn = document.getElementById("add-question-btn");
      addQuestionBtn.addEventListener("click", (e) => {
        e.preventDefault();
        const questionsContainer = document.getElementById(
          "questions-container"
        );
        const questionElement = `
        <div class="questions">
          <label class="block mt-4 text-sm font-medium text-gray-700">
            <span class="font-bold">Write Question</span>
            <textarea class="question block w-full mt-1 border border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" rows="4" placeholder="Write Question..."></textarea>
          </label>
          <label class="block mt-4 text-sm font-medium text-gray-700">Option-1
            <input type="text" class="option1 block w-full h-10 mt-1 border border-gray-300 rounded-md shadow-sm" />
          </label>
          <label class="block mt-4 text-sm font-medium text-gray-700">Option-2
            <input type="text" class="option2 block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm" />
          </label>
          <label class="block mt-4 text-sm font-medium text-gray-700">Option-3
            <input type="text" class="option3 block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm" />
          </label>
          <label class="block mt-4 text-sm font-medium text-gray-700">Option-4
            <input type="text" class="option4 block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm" />
          </label>
          <label class="block mt-4 text-sm font-medium text-gray-700">Answer
            <input type="text" class="answer block w-full mt-1 h-10 border border-gray-300 rounded-md shadow-sm" />
          </label>
        </div>
      `;
        questionsContainer.insertAdjacentHTML("beforeend", questionElement);
      });

      const saveBtn = document.getElementById("save-btn");

      saveBtn.addEventListener("click", async () => {
        const level = document.getElementById("level").value;
        const category = document.getElementById("category").value;
        const questions = [];
        const questionsContainer = document.querySelectorAll(".questions");

        questionsContainer.forEach((questionContainer) => {
          const question = questionContainer.querySelector(".question").value;
          const option1 = questionContainer.querySelector(".option1").value;
          const option2 = questionContainer.querySelector(".option2").value;
          const option3 = questionContainer.querySelector(".option3").value;
          const option4 = questionContainer.querySelector(".option4").value;
          const answer = questionContainer.querySelector(".answer").value;

          questions.push({
            question,
            options: [option1, option2, option3, option4],
            answer,
          });
        });

        const user = auth.currentUser;
        const idToken = await user.getIdToken();

        fetch("http://localhost:3030/questions/addQuestions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${idToken}`,
          },
          body: JSON.stringify({ level, category, questions }),
        })
          .then((response) => response.json())
          .then((data) => {
            message.textContent = "Questions saved successfully!";
          })
          .catch((error) => {
            message.textContent = `Error: ${error.message}`;
          });
      });

      onAuthStateChanged(auth, (user) => {
        if (user) {
          authContainer.classList.add("hidden");
          quizContainer.classList.remove("hidden");
          logoutBtn.classList.remove("hidden");
          header.classList.remove("hidden");
        } else {
          authContainer.classList.remove("hidden");
          quizContainer.classList.add("hidden");
          logoutBtn.classList.add("hidden");
          header.classList.add("hidden");
        }
      });

      logoutBtn.addEventListener("click", async () => {
        await signOut(auth);
        localStorage.removeItem("loggedInUserId");
        showMessage("", "message");
      });
    </script>
  </body>
</html>
